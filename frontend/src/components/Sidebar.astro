---
import { loadQuery } from '../lib/load-query';

const postsQuery = `count(*[_type == "post" && defined(slug.current)])`;
const categoriesQuery = `count(*[_type == "category" && defined(slug.current)])`;

const { data: postCount } = await loadQuery({ query: postsQuery });
const { data: categoryCount } = await loadQuery({ query: categoriesQuery });
---

<aside id="sidebar" aria-label="Sidebar">
  <div class="sidebar-wrapper">
    <div class="sidebar-wrap">
      <div class="sidebar-author">
        <img 
          src="https://res.cloudinary.com/dtd3kls2m/image/upload/v1767801692/author-avatar_rmbwbr.jpg" 
          alt="Author Avatar"
          class="author-avatar"
        />
        <div class="sidebar-author-name">Blank.428</div>
        <div class="sidebar-description">Con dốc nhạt nhoà</div>
      </div>

      <div class="sidebar-state">
        <div class="sidebar-state-item">
          <div class="sidebar-state-label">Bài viết</div>
          <div class="sidebar-state-number">{postCount}</div>
        </div>
        <div class="sidebar-state-item">
          <div class="sidebar-state-label">Loạt truyện</div>
          <div class="sidebar-state-number">{categoryCount}</div>
        </div>
      </div>

      <div class="sidebar-social">
        <a href="https://www.facebook.com/Blank.428/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="social-link">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
            <title>Facebook</title>
            <path fill="currentColor" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</aside>

<style>
  #sidebar {
    width: 268px;
    flex-shrink: 0;
  }

  @media (max-width: 1200px) {
    #sidebar {
      display: none;
    }
  }

  .sidebar-wrapper {
    position: sticky;
    top: calc(var(--header-height) + 20px);
  }

  .sidebar-wrap {
    background: var(--color-wrap);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow-card);
  }

  .sidebar-author {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .author-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin: 0 auto 1rem;
    box-shadow: var(--shadow-meta);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    cursor: var(--cursor-pointer);
  }

  .author-avatar:hover {
    box-shadow: var(--shadow-meta-hover);
    transform: scale(1.05);
  }

  .sidebar-author-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-default);
    margin-bottom: 0.5rem;
  }

  .sidebar-description {
    font-size: 0.95rem;
    color: var(--grey-9);
  }

  .sidebar-state {
    display: flex;
    justify-content: space-around;
    padding: 1.5rem 0;
    margin: 1.5rem 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  .sidebar-state-item {
    text-align: center;
  }

  .sidebar-state-label {
    font-size: 0.85rem;
    color: var(--grey-9);
    margin-bottom: 0.5rem;
  }

  .sidebar-state-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--red-1);
  }

  .sidebar-social {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--color-background);
    color: var(--color-default);
    transition: all 0.3s ease;
    cursor: var(--cursor-pointer);
  }

  .social-link:hover {
    background: var(--red-1);
    color: white;
    transform: translateY(-3px);
    box-shadow: var(--shadow-red-6-shadow);
  }

  .social-link svg {
    width: 20px;
    height: 20px;
  }
</style>
